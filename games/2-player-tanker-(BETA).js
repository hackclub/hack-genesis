/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: 2-player tanker
@author: NullClock
@tags: []
@addedOn: 2024-00-00
*/

const player1Up = "p";
const player2Up = "a";
const player1Left = "i";
const player2Left = "t";
const player1Right = "q";
const player2Right = "k";
const player1Down = "y";
const player2Down = "o";
const line = "l";
const bullet = "r";
const bulletDown = "b";
const bulletLeft = "v";
const bulletRight = "j";
const numbers = [
  ["1", bitmap`
0000000000000000
0000000200000000
0000002200000000
0000022200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000000200000000
0000022222000000
0000000000000000`],
  ["2", bitmap`
0000000000000000
0000022222000000
0000220002200000
0002200000220000
0000000000020000
0000000000020000
0000000000220000
0000000002200000
0000000022000000
0000000220000000
0000002200000000
0000022000000000
0000220000000000
0002222222222000
0000000000000000
0000000000000000`],
  ["3", bitmap`
0000000000000000
0000022222200000
0000220000220000
0002200000022000
0000000000002000
0000000000002000
0000000000020000
0000000000220000
0000000222200000
0000000000220000
0000000000022000
0000000000002000
0002200000022000
0000220000220000
0000022222200000
0000000000000000`],
  ["4", bitmap`
0000000000000000
0000000000220000
0000000002020000
0000000022020000
0000000220020000
0000002200020000
0000022000020000
0000220000020000
0002200000020000
0000222222222000
0000000000020000
0000000000020000
0000000000020000
0000000000020000
0000000000020000
0000000000000000`],
  ["5", bitmap`
0000000000000000
0002222222222200
0000000000000200
0000000000000200
0000000000000200
0000000000000200
0000000000002200
0000000000220000
0000022222200000
0002200000000000
0002000000000000
0002000000000000
0002000000000000
0002200000000000
0000022222222200
0000000000000000`],
  ["6", bitmap`
0000000000000000
0000000000220000
0000000002200000
0000000222000000
0000002200000000
0000002000000000
0000022000000000
0000222222000000
0002200000220000
0002000000020000
0002000000020000
0002000000020000
0000200000200000
0000220002200000
0000022222000000
0000000000000000`],
  ["7", bitmap`
0000000000000000
0000022222222000
0000000000002000
0000000000002000
0000000000020000
0000000000020000
0000000000020000
0000000000200000
0000000000200000
0000000002000000
0000000002000000
0000000020000000
0000000020000000
0000000200000000
0000002000000000
0000000000000000`],
  ["8", bitmap`
0000000000000000
0000222222220000
0002000000002000
0002000000002000
0002000000002000
0002000000002000
0002000000002000
0002000000002000
0000222222220000
0002000000002000
0002000000002000
0002000000002000
0002000000002000
0002000000002000
0000222222220000
0000000000000000`],
  ["9", bitmap`
0000000000000000
0000002222200000
0000022000220000
0000220000022000
0000200000002000
0000200000002000
0000220000002000
0000022000022000
0000002222220000
0000000002200000
0000000022000000
0000000220000000
0000002200000000
0000022000000000
0000020000000000
0000000000000000`],
  ["0", bitmap`
0000000000000000
0000222222220000
0002200000022000
0002000000022000
0002000000222000
0002000000202000
0002000002202000
0002000022002000
0002000020002000
0002000220002000
0002002200002000
0002022000002000
0002220000002000
0002200000022000
0000222222220000
0000000000000000`],
];

setLegend(
  [ player1Up, bitmap`
................
.....000000.....
.....0DDDD0.....
.....00DD00.....
......0DD0......
..000.0DD0.000..
..01100DD00110..
..0L444DD444L0..
..01444DD44410..
..0L44DDDD44L0..
..0144DDDD4410..
..0L44444444L0..
..014444444410..
..0LL000000LL0..
..0000....0000..
................` ],
  [ player2Up, bitmap`
................
.....000000.....
.....055550.....
.....005500.....
......0550......
..000.0550.000..
..011005500110..
..0L77755777L0..
..017775577710..
..0L77555577L0..
..017755557710..
..0L77777777L0..
..017777777710..
..0LL000000LL0..
..0000....0000..
................` ],
  [ player1Left, bitmap`
................
................
.0000000000.....
.0L1L1L1L10.....
.0L44444410.....
.004444440..000.
..044DD440000D0.
..044DDDDDDDDD0.
..044DDDDDDDDD0.
..044DD440000D0.
.004444440..000.
.0L44444410.....
.0L1L1L1L10.....
.0000000000.....
................
................` ],
  [ player2Left, bitmap`
................
................
.0000000000.....
.0L1L1L1L10.....
.0L77777710.....
.007777770..000.
..0775577000050.
..0775555555550.
..0775555555550.
..0775577000050.
.007777770..000.
.0L77777710.....
.0L1L1L1L10.....
.0000000000.....
................
................` ],
  [ player1Right, bitmap`
................
................
.....0000000000.
.....01L1L1L1L0.
.....01444444L0.
.000..044444400.
.0D000044DD440..
.0DDDDDDDDD440..
.0DDDDDDDDD440..
.0D000044DD440..
.000..044444400.
.....01444444L0.
.....01L1L1L1L0.
.....0000000000.
................
................` ],
  [ player2Right, bitmap`
................
................
.....0000000000.
.....01L1L1L1L0.
.....01777777L0.
.000..077777700.
.0500007755770..
.0555555555770..
.0555555555770..
.0500007755770..
.000..077777700.
.....01777777L0.
.....01L1L1L1L0.
.....0000000000.
................
................` ],
  [ player1Down, bitmap`
................
..0000....0000..
..0LL000000LL0..
..014444444410..
..0L44444444L0..
..0144DDDD4410..
..0L44DDDD44L0..
..01444DD44410..
..0L444DD444L0..
..01100DD00110..
..000.0DD0.000..
......0DD0......
.....00DD00.....
.....0DDDD0.....
.....000000.....
................` ],
  [ player2Down, bitmap`
................
..0000....0000..
..0LL000000LL0..
..017777777710..
..0L77777777L0..
..017755557710..
..0L77555577L0..
..017775577710..
..0L77755777L0..
..011005500110..
..000.0550.000..
......0550......
.....005500.....
.....055550.....
.....000000.....
................` ],
  [ line, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000` ],
  [ bullet, bitmap`
......0000......
.....006600.....
....00666600....
...0066666600...
..006666666600..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..000000000000..` ],
  [ bulletDown, bitmap`
..000000000000..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..066666666660..
..006666666600..
...0066666600...
....00666600....
.....006600.....
......0000......` ],
  [ bulletLeft, bitmap`
................
................
000000000000....
0666666666600...
06666666666600..
066666666666600.
0666666666666600
0666666666666660
0666666666666660
0666666666666600
066666666666600.
06666666666600..
0666666666600...
000000000000....
................
................` ],
  [ bulletRight, bitmap`
................
................
....000000000000
...0066666666660
..00666666666660
.006666666666660
0066666666666660
0666666666666660
0666666666666660
0066666666666660
.006666666666660
..00666666666660
...0066666666660
....000000000000
................
................` ],
  ...numbers
)

const numNames = [
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "0"
];

const player1Sprites = [ player1Up, player1Down, player1Left, player1Right ];
const player2Sprites = [ player2Up, player2Down, player2Left, player2Right ];
const bulletSprites = [ bullet, bulletDown, bulletRight, bulletLeft ];

setSolids([ ...numNames, ...player1Sprites, ...player2Sprites, line ])

let level = 0
const levels = [
  map`
l0llllllllll0l
l..l.........l
l.lll.lllll..l
l...o.l...l..l
lll......lll.l
l........l...l
lllllll..l...l
l........l...l
lll..l..llll.l
l.l.pll....l.l
l.....l......l
llllllllllllll`
]

setMap(levels[level])

let tracks = [
tune`
0,
250: F3^250,
250: D3^250,
250: E3^250,
250: D3^250,
250: F3^250,
250: E3^250,
500: G3^250,
250: F3^250,
250: D3^250,
250: E3^250,
250: D3^250,
250: F3^250,
250: E3^250,
500: G3^250,
0: F3^250,
250: F4^250,
0: D3^250,
250: D4^250,
0: E3^250,
250: E4^250,
0: D3^250,
250: D4^250,
0: F3^250,
250: F4^250,
0: E3^250,
250: E4^250,
0: G3^250,
500: G4^250,
0: F3^250,
250: F4^250,
0: D3^250,
250: D4^250,
0: E3^250,
250: E4^250,
0: D3^250,
250: D4^250,
0: F3^250,
250: F4^250,
0: E3^250,
250: E4^250,
0: G3^250,
7500: G4^250,
`,
];

function playTuneLoop(tuneArray) {
  tuneArray.forEach((tune, i) => {
    playTune(tune);
  });
}

function startBullet(owner, rotation) {
  addSprite(owner.x, owner.y, rotation);
}

setInterval(() => {
  getAll(bullet).forEach((bullet) => {
    bullet.y -= 1;
  });

  getAll(bulletDown).forEach((bullet) => {
    bullet.y += 1;
  });

  getAll(bulletLeft).forEach((bullet) => {
    bullet.x += 1;
  });

  getAll(bulletRight).forEach((bullet) => {
    bullet.x -= 1;
  });
}, 100);

playTuneLoop(tracks);
setInterval(() => {
  playTuneLoop(tracks);
}, 8200);

let currentPlayerState = player1Up;
let currentPlayerTwoState = player2Down;
function switchPlayerSprite(changeSprite) {
  const p = getFirst(currentPlayerState);
  clearTile(p.x, p.y);
  addSprite(p.x, p.y, changeSprite);
  currentPlayerState = changeSprite;
}

function switchPlayerTwoSprite(changeSprite) {
  const p = getFirst(currentPlayerTwoState);
  clearTile(p.x, p.y);
  addSprite(p.x, p.y, changeSprite);
  currentPlayerTwoState = changeSprite;
}

onInput("s", () => {
  getFirst(currentPlayerState).y += 1
  switchPlayerSprite(player1Down);
  startBullet(getFirst(currentPlayerState), bulletDown);
})

onInput("w", () => {
  getFirst(currentPlayerState).y -= 1
  switchPlayerSprite(player1Up);
  startBullet(getFirst(currentPlayerState), bullet);
})

onInput("a", () => {
  getFirst(currentPlayerState).x -= 1
  switchPlayerSprite(player1Right);
  startBullet(getFirst(currentPlayerState), bulletRight);
})

onInput("d", () => {
  getFirst(currentPlayerState).x += 1
  switchPlayerSprite(player1Left);
  startBullet(getFirst(currentPlayerState), bulletLeft);
})

onInput("k", () => {
  getFirst(currentPlayerTwoState).y += 1
  switchPlayerTwoSprite(player2Down);
  startBullet(getFirst(currentPlayerTwoState), bulletDown);
})

onInput("i", () => {
  getFirst(currentPlayerTwoState).y -= 1
  switchPlayerTwoSprite(player2Up);
  startBullet(getFirst(currentPlayerTwoState), bullet);
})

onInput("j", () => {
  getFirst(currentPlayerTwoState).x -= 1
  switchPlayerTwoSprite(player2Right);
  startBullet(getFirst(currentPlayerTwoState), bulletRight);
})

onInput("l", () => {
  getFirst(currentPlayerTwoState).x += 1
  switchPlayerTwoSprite(player2Left);
  startBullet(getFirst(currentPlayerTwoState), bulletLeft);
})

afterInput(() => {
  
})